\documentclass[a4paper]{report}
\usepackage{master}
\begin{document}

\author{Тузова Екатерина}
\title{Ebooks searching, reading, managing system}

\maketitle
% подумать про заголовки


\abstract{
Мотивацией для данного проекта послужило желание облегчить работу пользователей с электронными книгами. Ресурсы, которые сейчас есть в интеренете, позволяют пользователю последовательно сначала находить нужную книгу, затем самостоятельно скачивать и искать программу, которая может работать с файлом в заданном формате.

Основная идея проекта -- избавить пользователя от лишних и трудоемких действий, оставив ему самую приятную часть -- непосредственно чтение книги. Таким образом, проект призван объединить все стадии подготовки к чтению(поиск, скачивание, открытие файла) в одну. }

\newpage
\tableofcontents
\newpage

\numlesschap{Введение}
В последние годы влияние Интернета на жизнь человека становится все сильнее. Это обусловлено тем, что Интернет предоставляет гораздо больше удобства и возможностей для доступа к информации. Не оказалась в стороне от Интернета и такая важная часть работы и досуга, как чтение книг.

 Если 20 лет назад человек хотел почитать книгу, он шел в библиотеку или в книжный магазин. Если он искал определённую книгу -- достаточно было назвать фамилию автора и название книги, а порой одного названия было достаточно. Если же выбор книги ещё не был сделан, всегда можно было получить помощь от сотрудника магазина или библиотеки. Сегодня ситуация с библиотеками и книжными магазинами изменилась несильно. 

Наравне с бумажными книгами появилась возможность читать книги в электронном виде. Большое количество книг оцифровано и хранится в сети Интернет, многие из них в свободном доступе. С одной стороны это должно упрощать процесс получения книг, теперь они стали доступны из любого места, где есть возможность выхода в Интернет. С другой стороны, перед пользователем встает новая проблема -- теперь ему необходимо самому искать эту книгу в сети, где количество информации растет с каждым днем. Но эта проблема не единственна. После того, как он нашел нужную книгу -- ее нужно скачать, а затем найти программу, которая может работать с файлом в найденном формате. 

%TODO 
На настоящий момент в Интернете существует множество электронных библиотек, поиск по которым весьма затруднен из-за того, что не существует системы, которая могла бы объединить всю информацию с этих библиотек. Поэтому пользователям приходится либо искать в каждой из электронных библиотек в отдельности, либо пользоваться существующими поисковыми системами. Вторая проблема, связанная с наличием большого количества электронных библиотек в том, что единый формат для предоставления информации о книгах появился только недавно. 

У существующих поисковых систем есть одна очень важная особенность -- они обладают ограниченными возможностями в проведении специализированного поиска в сети. Поэтому при поиске пользователь получает всю информацию, которая соответствует поисковому запросу. И дальше уже начинается работа самого пользователя над тем, чтобы эту информацию профильтровать и извлечь оттуда именно то, что ему нужно. 

Таким образом, выявляются две важные проблемы, затрудняющие поиск книг. Первая проблема -- различные библиотеки имеют разные интерфейсы, вторая -- существует множество форматов, в которых может быть представлена электронная книга. 

В данной работе была разработана система, упрощающая задачу поиска, чтения и управления книгами. 


\numlesschap{Обзор существующих решений}

Уже предпринимались попытки решить эти проблемы.

Например, широко известная поисковая система Google предоставляет свой сервис для поиска электронных книг -- Google books (\url{http://books.google.com}). Этот сервис выполняет полнотекстовый поиск по книгам, которые Google сканирует и сохраняет в своей базе данных. В качестве результатов выдается большое количество информации о самой книге, об изданиях этой книги и ссылки на ресурсы, где пользователь может купить эту книгу. Благодаря полнотекстовому поиску  по содержанию, есть возможность найти книгу, имея сильно ограниченное количество информации о ней. Это не решает ни проблему унифицированного доступа к информации о книгах, ни проблему различных форматов книг.

Например, ebdb.ru(electronics books data base)  -- это поисковая система, которая обходит интернет и сохраняет у себя ссылки на страницы других ресурсов, содержащие ссылки на книги. В результате поиска выдается список ссылок на страницы, содержащие книги. Для того, чтобы получить книгу пользователь должен перейти по ссылке, и, возможно, зарегистрироваться на ресурсе. Это решает проблему поиска книг, находящихся в свободном доступе, но остаются другие задачи, которые пользователь вынужден выполнять сам (скачивание книг, и поиск подходящей программы для просмотра). Так же эта поисковая система не решает проблемы унифицированного доступа и проблему различных форматов книг.

Есть большие системы, решающие проблему унифицированного доступа и различных форматов книг, а именно, Amazon Kindle, Sony Reader и подобные. 
Это программно-аппаратные платформы для чтения электронных книг. Они предоставляют устройство, которое имеет доступ к определенному хранилищу. Пользователь может подключить свое устройство к Интернету, найти нужную книгу в этом хранилище и купить ее. Дальше устройство само скачает эту книгу и откроет ее.
Из минусов у таких систем то, что это платные системы и зависимые от устройства. Так же количество доступных книг -- ограничено теми книгами, которые хранят/продают хранилища, к которым они подключаются. Но это не единственные минусы таких систем, так у Amazon Kindle за каждый загруженный текст (вне зависимости от источника загрузки) требуется заплатить компании Amazon от 10 центов. Еще Amazon контролирует информацию, содержащуюся на устройствах, находящихся у пользователей и по своему усмотрению удаляет её (в том числе книги, приобретённые непосредственно у Amazon).

Существует открытая технология, решающая проблему унифицированного доступа  -- OPDS (Open Publication Distribution System).
OPDS -- это новый активно развивающийся стандарт, который построен на базе расширяемого языка разметки Atom. Этот стандарт был специально разработан для предоставления информации об электронных документах. В стандарте учтены особенности такого рода информации (наличие аннотации, автора, изображения обложки и пр.).
Основная идея существования такого стандарта в том, что если многие сайты будут распостранять свою информацию о книгах в таком формате, то клиентские программы могут подключаться к большому количеству сайтов. Несмотря на то, что стандарт появился недавно, уже существуют сайты и клиетские программы, использующие этот протокол. 

\begin{figure}
\centering
\includegraphics[width=.5\textwidth]{scheme}
\caption{Схема взаимодействия с использованием формата OPDS}\label{fig:scheme}
\end{figure}

Одим из самых крупных сайтов, предоставляющих информацию по протоколу OPDS, является BookServer (\url{http://bookserver.archive.org}).
Этот некоммерческий проект является частью проекта Internet Archive (\url{http://archive.org}) и является универсальной и открытой системой распостранения электронных книг. BookServer это архитектура, объединяющая различные форматы книг, конвертируя их, при необходимости, в нужный формат. Система обеспечивает каталогизацию книг, имеющихся в магазинах, библиотеках или в открытом доступе. Электронный текст можно прочитать на любом конечном устройстве, будь то нетбук, смартфон или специализированное устройство для чтения, наподобие Kindle. Хотя сайтом уже можно пользоваться, он еще находится на стадии разработки, с чем, вероятно, связано отсутствие расширенного поиска по книгам, фильтрации по языкам/жанрам. 

%STOP
\numlesschap{Описание системы в целом}
Проект состоит из серверной и клиентской частей.

Серверная часть собирает в сети Интернет информацию об электронных книгах и представляет собранную информацию для обычных пользователей в виде web-интерфейса и для клиентских программ -- в формате OPDS.

Клиентская часть представляет собой программу для удобной работы с сервером, предоставляющим по запросам информацию в формате OPDS. Клиент должен работать как с "родным" сервером, так и с другими серверами, поддерживающими OPDS, например feedbooks.com.

Серверная часть проекта состоит из 3 подпроектов:
\begin{itemize}
	\item собственно web-сервер, включающий базу данных, поиск по ней, представление информации в web и opds форматах (python, django)
	\item сборщик информации в сети (crawler) (java)
	\item анализатор найденной информации, разбирающий информацию о книгах (java) 
\end{itemize}
Клиентских программ написано 2:
\begin{itemize}
	\item На С++ (с интерфейсом Qt)
	\item На Java 
\end{itemize}

Клиентская программа на Java более переносима, но для нее необходимо на девайсе иметь java-машину. В свою очередь программа на Qt не требует установки никаких дополнительных библиотек, работает быстрее, но переносимость ниже, чем у java.
		
\numlesschap{Описание компонентов системы и их взаимодействие}

% Может стоит вставить пару картинок

Пользователь устанавливает у себя на машине одну из клиентских программ. При поиске книги программа обращается к одному из серверов, поддерживающих протокол OPDS,(OpenSearch?). Сервер обрабатывает запрос, и возвращает данные в в нужном формате. Счастливый пользователь может читать книгу.


\numlesschap{Постановка задачи}

После того, как книги найдены и добавлены в базу данных, появляются новые задачи -- это предоставление информации, а так же верификация и обновление данных. Сервер предоставляет информацию двумя способами -- в HTML виде для пользователей, желающих использовать web-browser, и по протоколу OPDS -- для клиентских программ. Базу данных нужно все время поддерживать в рабочем состоянии. А информация, поступающая от "поискового паука" (crawler) и анализатора (analyzer) зачастую бывает весьма сомнительного качества. Это происходит из-за того, что иногда "поисковый паук" находит книги, для которых анализатор не может определить автора/название. В таком случае в базу добавляется только ссылка на файл. 
Позже мы пытаемся извлечь нужную информацию из самого файла.

Для книг, которые уже находятся в базе происходит поиск дополнительной информации, такой как аннотация, теги и пр. Поиск дополнительной информации происходит не только для книг, но и для авторов.

Основой для данной работы послужили задачи поиска доп. информации, структурирование информации и предоставление ее пользователю.


\numlesschap{ Задача представления информации}

Информация, хранящаяся на сервере, предоставляется двумя способами -- в HTML виде для пользователей, желающих использовать web-browser, и по протоколу OPDS -- для клиентских программ. Фреймворк Django, использованный для реализации приложения, позволяет использовать очень высокий уровень абстракции.

Главной идеей в Django является разделение задач. Каждая задача выделена в отдельный файл:
% TODO Для каждого из пунктов вставить маленький кусочек кода
\begin{itemize}
	\item Файл models.py содержит описание таблицы базы данных, представленное в виде класса Python. Такой класс называется моделью. С помощью данного класса можно создавать, получать, обновлять и удалять записи в таблице базы данных, используя простой код на языке Python вместо использования повторяющихся SQL команд.
	\item Файл views.py содержит логику отображения страницы. В этом файле содержатся функции, которым передается URL запрос. Такие функции называются представлением.
	\item Файл urls.py определяет какое именно представление будет вызвано для URL, заданного в виде шаблона. 
	\item Так же есть файлы-шаблоны, которые описывают дизайн страницы. Эти файлы испольщуют свой шаблонный язык.
\end{itemize}

 Объединённые вместе, эти компоненты приложения следуют шаблону Модель-Представление-Управление  (Model-View-Controller, MVC). MVC определяет способ разработки программного обеспечения при котором код для определения и доступа к данным (модель) отделён от логики приложения (управление), которая в свою очередь отделена от интерфейса пользователя (представление). В этой концепции термин «Модель» относится к логике доступа к данным; термин «Представление» относится к той части системы, которая определяет, что показать и как; а термин «Управление» относится к той части системы, которая определяет какое представление надо использовать, в зависимости от пользовательского ввода, по необходимости получая доступ к модели. 

Основное преимущество такого подхода заключается в свободе объединения этих компонентов. Следовательно, каждая отдельная часть приложения, созданного с помощью Django, имеет одно назначение и может быть изменена независимо, т.е., без влияния на остальные компоненты. Например, разработчик может изменить URL для данной части приложения без изменения остального кода. Дизайнер может изменить HTML страницы без внесения изменений в код, который отображает страницу. Администратор базы данных может переименовать таблицу и определить эти изменения в одном месте, вместо того, чтобы искать и вносить изменения во множество файлов.

Таким образом, для того, чтобы реализовать два способа предоставления информации, достаточно было для каждой страницы описать по два файла-шаблона (для HTML и для OPDS) и назначить url-связывание. Логика отображения страницы для обоих представлений одинакова и не зависима от способа отображения этой информации. 

Вторая использованная абстракция -- это абстракция от поискового механизма. Сервер предоставляет пользователю возможность простого и расширенного поиска по книгам. Для улучшения поиска используются различные техники, улучшающие сам поиск, такие как soundex, исправление опечаток и др. %какие?? 

При обработке запроса используется абстракция SEARCH\_ ENGINE, которая помогает работать с поиском не зависимо от того, какой механизм используется.

%TODO вставить код

Реализованные возможности предоставления информации:
\begin{itemize}
	\item Каталог (В каталоге реализованы различные разбиения множества книг -- по авторам ( внутри разбиение по первым 1/2 буквам имени), языкам, жанрам)
	\item Простой поиск -- при выводе результатов поиска вначале есть ссылки на авторов, если в запросе было слово, похожее на автора
	\item Расширенный поиск -- позволяет искать отдельно по заголовку, имени автора, языку, жанру. Если поиск производится только по авторам -- выдается список авторов ( ссылки на страничку с информацией об авторе ), иначе -- список книг, удовлетворяющих условиям поиска
\item Вывод информации об отдельной книге
\item Вывод информации об авторе ( + список ассоциированных с ним книг)
\item Корректирование запроса пользователя (did you mean)
\end{itemize}


\numlesschap{Задача верификации и обновления информации}

Следующая задача -- задача верификации и обновления информации. Для решения задачи верификации -- реализован интерфейс администратора, для обновления и пополнения информации -- поиск информации на внешних ресурсах, классификация книг на основе аннотации, поиск информации внутри отдельной книги.

\numlesschap{Поиск информации на внешних ресурсах}
Поиск дополнительной информации происходит на сайте Amazon (\url {www.amazon.com}) - поиск аннотации для книг и на сайте wikipedia (\url {www.en.wikipedia.org}) происходит поиск дополнительной информации для авторов(теги).


\numlesschap{Задача определения жанра книги}
На сервере хранится база данных, заполненная собранной в интернете информацией о книгах. В информацию о книге входят -- название, автор, описание, жанр и некоторые другие поля. Обязательными для книги являются поле названия книги и автор (у каждой книги может быть указано больше одного автора). Для некоторых книг в найденной информации уже указан жанр, для других -- нет. Для более удобной навигации пользователя по базе сервер предоставляет возможность различных выборок, в том числе по жанру, но для многих книг анализатор не может определить жанр, исходя из информации, находящейся на той странице, где была найдена книга. Для предоставления пользователю более полной информации реализовано определение жанра книги, исходя из её аннотации. 

%TODO подробнее про "байесовского классификатора с использованием метода Фишера"
Для определения жанра книги создан классификатор, построенный на основе наивного байесовского классификатора. Наивный байесовский классификатор это простой вероятностный классификатор, основанный на применении Теоремы Байеса со строгими (наивными) предположениями о независимости. Для определения вероятности для всего документа был выбран метода Фишера. 
В отличие от наивной байесовсой фильтрации, когда для вычисления вероятности всего документа перемножаются вероятности отдельных признаков, по методу Фишера вычисляется вероятность отнесения к той или иной категории для каждого признака документа, после чего эти вероятности комбинируются и проверяется, насколько получившееся множество похоже на случайное.

В качестве входа классификатор принимает текст. Этот текст разбивается на слова, которые проходят через Stemmer. Стемминг -- это процесс нахождения основы слова для заданного исходного слова. Основа слова необязательно совпадает с морфологическим корнем слова. В итоговый вектор добавляются все слова и пары слов, встреченные в тексте.

В случае классификации книг в качестве текста были взяты название книги и ее аннотация. В том случае, если описание  еще не хранится базе данных происходит поиск на Amazone.

Таким образом во время классификации решается задача поиска дополнительной информации о книгах на внешних ресурсах.

\numlesschap{Извлечение информации из формата epub и fb2}

Для пополнения базы данных так же используется извлечение информации из книг в формате epub и fb2. В случае если анализатор не смог определить название полученной от поискового паука книги и ее автора, но найденный файл в фомате fb2 или epub, в базу данных добавляется ссылка на этот файл, но эта ссылка не привязывается ни к какой книге. Это делается, \tk из этих форматов можно извлечь нужную информацию. 

%TODO может быть xml схемы?
Electronic Publication (ePub) — открытый формат электронных версий книг. Формат позволяет издателям производить и распространять цифровую публикацию в одном файле, обеспечивая совместимость между программным и аппаратным обеспечением, необходимым для воспроизведения незашифрованных цифровых книг и других публикаций с плавающей вёрсткой.
Zip-архив контейнера ePub содержит тексты в форматах xHTML, HTML или PDF, описание издания в XML, рядом в папках — графика, включая векторную (SVG), и встроенные шрифты, таблицы стилей и \td 

FictionBook — формат представления электронных версий книг в виде XML-документов, где каждый элемент книги описывается своими тегами. Стандарт призван обеспечить совместимость с любыми устройствами и форматами. XML позволяет легко создавать документы, готовые к непосредственному использованию и программной обработке (конвертации, хранению, управлению) в любой среде. Документы содержат структурную разметку основных элементов текста, некоторое количество информации о книге, а также могут содержать вложения с двоичными файлами, в которых могут храниться иллюстрации или обложка.

Оба формата хранят информацию о книге в удобном для автоматической обработки формате. Оба формата имеют xsl-схему, с помощью которой происходит валидация документа и с помощью которой был написан парсер извлекающий нужную информацию.

\numlesschap{Реализация интерфейса администратора}
%TODO может надо про то, как он генерируется рассказать. А то как то сразу про настройку.

В Django есть встроенный интерфейс администратора. Это веб-интерфейс, доступный администраторам сайта, который предоставляет возможность добавления, редактирования и удаления содержимого сайта. Получая метаданные из описанных моделей, он предоставляет мощный интерфейс промышленного уровня, который может быть немедленно использован для наполнения сайта информацией.

Каждый тип обьектов в интерфейсе администратора обладает формой редактирования и список обьектов. Список объектов отображает все доступные обьекты в базе данных, а форма редактирования позволяет добавлять, изменять и удалять конкретные записи. 
Разные типы полей имеют разное отображение (виджеты) -- например, поля даты/времени управляются через календарь, булево поле -- через чекбокс, текстовое поле -- обычное поле ввода. 
Автоматическая генерация интерфейса администратора удобна, но ввиду того, что это очень общая задача -- некоторые типы полей отображаются очень неудобно для редактирования. Интерфейс администратора предназначен для использования неквалифицированными пользователями и, следовательно, он должен быть самодостаточным.

\subsubsection{Как появляется интерфейс администратора}

Когда Django загружает схему URL из url.py  при старте сервера, выполняется функция admin.autodiscover(), которая добавиляется для активации интерфейса администрации. Эта функция проходит по элементам параметра INSTALLED\_ APPS и проверяет наличие файла admin.py в каждом установленом приложении. Если файл присутствует, выполняется его код. Внутри этого файла происходит регистрация моделей в интерфейсе администратора. %TODO пример

Простая настройка интерфейса администратора предоставляет немного возможностей - сделать поля необязательными, изменить метки полей, выбрать из ограниченного набора способ, которым будет отображаться поле.

Несмотря на всё это, административный интерфейс является всего навсего простым приложением Django, со своими собственными моделями, шаблонами, представлениями и схемой URL. Таким образом есть возможность настройки этого интерфейса для своего приложения.

\subsubsection{Задачи, которые не решает встроенный интерфейс}
\begin{itemize}
	\item Отображение полей многие-ко-многим.
	\item Поиск
\end{itemize}

%\subsection{Решения}
Одной из главных проблем интерфейса администратора является ограниченный выбор способа отображения полей многие-ко-многим. В интерфейсе, предоставляемом Django -- для отображения таких полей есть несколько возможностей(виджетов):
\begin{itemize}
	\item Select -- список с возможностью множественного выбора.
	\item Filter horizontal/vertical -- два списка (horizontal/vertical определяет их относительное местоположение). Один из списков представляет собой список всех вожможных вариантов выбора, второй -- выбранные элементы.
	\item Raw\_ id -- представляет собой input-строку, с перечисленными в ней id выбранных элементов. Есть возможность добавлять элементы.
\end{itemize}
Первые два варианта -- загружают в список все возможные варианты выбора целиком. Для модели, содержащей большое количество связей типа многие-ко-многим этот вариант не подходит, \tk загружать весь список становится слишком долго. Хотя, надо заметить, что на небольшом количестве таких связей такое отображение выглядит очень удобно( В представленной базе данных это отображение используется для связей тег-книга). 
Третий вариант больше подходит для отображения большого количества связей, но у него есть один недостаток -- в текстовом поле отображаются только id элементов, связанных с данным. Очень маловероятно, что человеку (администратору) будет удобно оперировать в терминах id объектов.

Таким образом возникает задача создания удобного виджета для отображения авторов, связанных с конкретной книгой.
Было решено реализовать эту связь в формате нескольких checkbox'ов, с возможностью добавлять
новые.

\subsection{Реализация}

При создании интерфейса администратора для каждой модели в базе данных создаются классы ModelAdmin, которые предоставляют возможности настройки его работы для конкретной модели.

При создании интерфейса администратора мы первым делом регистрируем модель. При 
регистрации есть возможность указать форму, которая будет использоваться при
отображении. Так же для поля m2m указываем способ отображения -- raw id.

Далее, создадим свою форму, которая наследуется от forms.ModelForm.
Внутри формы для каждого из полей модели можно специфицировать используемый 
виджет. Для нашего m2m мы создадим собственный виджет. Для того, чтобы сохранить 
нужное поведение мы наследуемся от forms.CheckboxSelectMultiple, 
ManyToManyRawIdWidget. Осталось переопределить метод render, который генерирует 
начинку нашего виджета. Внутри этого метода, которому передаются id -- нужно
обратиться к  базе и по id узнать имена авторов. Затем вызвать метод render
от checkbox, которому передать список пар (author id, author name).

Теперь мы умеем отображать имеющуюся информацию в удобном нам виде. Но если мы 
попробуем сейчас сохранить нашу книгу -- ничего не выйдет. Это произошло от того, 
что внутри стандартного метода save используется метод cleaned\_ data, который 
извлекает информацию из форм, затем происходит проверка -- изменилась ли эта 
информация и сохранение. Метод cleaned\_ data из checkbox извлекает не только id.
Значит нам нужно руками вытащить id и сохранить в словарь. Теперь наша форма
умеет правильно сохраняться в базу.

Осталось добавить возможность добавления авторов. Это делается уже с помощью 
javascript. 

 
%\begin{figure}
%\centering
%\includegraphics[width=.5\textwidth]{scheme}
%\caption{Мега-схема проекта}\label{fig:scheme}
%\end{figure}
%\picref{fig:scheme}	ссылка на картинку

\numlesschap{Заключение}

\end{document}

