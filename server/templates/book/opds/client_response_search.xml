<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="/stylesheets/catalog.xsl"?>

<feed xmlns:opensearch="http://a9.com/-/spec/opensearch/1.1/" xmlns:thr="http://purl.org/syndication/thread/1.0" xml:lang="en-US" xmlns:app="http://www.w3.org/2007/app" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns="http://www.w3.org/2005/Atom" xmlns:dcterms="http://purl.org/dc/terms/">

    <link href="{{ server }}/books/search.atom?" rel="alternate"></link>
    <link href="{{ server }}/books/search.atom?items_per_page={{items_per_page}};query={{ query }}" rel="self"></link>
    <link rel="next" href="{{ server }}/books/search.atom?page={{next}};items_per_page={{items_per_page}};query={{ query }}"/>
    
    <link type="application/opensearchdescription+xml" rel="search" title="Open Search Description" href="/opensearch.xml"/>

    
    <title>Search results for: 
    {% if query %}
        Query "{{ query }}";
    {% endif %}
    {% if title %}
        Title "{{ title }}";
    {% endif %} 
    {% if author %}
        Author "{{ author }}";
    {% endif %}
    </title>
    
    <!--id></id>
    <updated></updated>
    <icon></icon>
    <author></author-->
    
    <opensearch:totalResults> {{ total }} </opensearch:totalResults>
    <opensearch:itemsPerPage> {{ items_per_page }} </opensearch:itemsPerPage>
    {% if start_index %}
    <opensearch:startIndex> {{ start_index }} <opensearch:startIndex>
    {% endif %}
    
    {% for book in books %}
    <entry>
        <title> {{ book.title }} </title>
        <dcterms:language> {{ book.lang }} </dcterms:language>
        <id> {{ book.id }} </id>
        <link> {{ server }}/book.atom/id{{ book.id }}</link>
        <!--dcterms:issued></dcterms:issued>
        <dcterms:source></dcterms:source>
        <updated></updated-->
        
        {% for tag in book.tag.all %}
            <category term="tag"/>
        {% endfor %}

        

        {% for author in book.author_set.all %}
        <author>
            <name> {{ author.name }} </name>
            <uri> {{ server }}/author.atom/id{{ author.id }}</uri>
        </author>
        {% endfor %}
        
        
        <summary>
            {{ book.annotation.all.0 }}
        </summary>

        <link type="application/atom+xml;type=entry" rel="alternate" title="Full entry" href="book.atom/id{{ book.id }}"/>
        {% for book_file in book.book_file.all %}
            <link type="{{ book_file.type }}" href="{{ book_file.link }}" />
            <link type="image/png" rel="http://opds-spec.org/cover" href="{{book_file.img_link}}"/>
        {% endfor %}  
       
    </entry>
    {% endfor %}
</feed>
