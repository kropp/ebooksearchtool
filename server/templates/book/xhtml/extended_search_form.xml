{% load i18n %}

{%if USE_AUTOCOMPLETE%}
<script type="text/javascript" src="{{MEDIA_URL}}/js/views/jQuery.js"></script>
<script type="text/javascript" src="{{MEDIA_URL}}/js/views/jquery-autocomplete/jquery.autocomplete.js"></script>
<link rel="stylesheet" type="text/css" href="{{MEDIA_URL}}/css/jquery.autocomplete.css" />
{%endif%}
<div id="header">

<div id="lang" align="right">
    <form action="/i18n/setlang/" method="post">
        <font size="2">{% trans "Change language:" %}</font>
        <select name="language">
        {% for lang in LANGUAGES %}
        {% ifequal  lang.0 request.LANGUAGE_CODE%}
            <option value="{{ lang.0 }}" selected>{{ lang.1 }}</option>
        {% else %}
            <option value="{{ lang.0 }}" >{{ lang.1 }}</option>
        {%endifequal%}
        
        {% endfor %}
        </select>
        <input type="submit" value="{%trans "Go" %}" />
    </form>
</div>

<script type="text/javascript">function checkForm(form) {
    var errorList = [];    
    for (var i = 0; i < form.elements.length; i++) {
    el = form.elements[i];
    elName = el.nodeName.toLowerCase();
    value = el.value;
    if (elName == "input") {
        type = el.type.toLowerCase();
        if( type == "text" && value == "") {
                errorList.push(1);
        }
    }
    if (elName == "select") {
        if( value == "") {
                errorList.push(1);
        }
    }

    }
if (errorList.length < 4) return true;
return false;

}</script>

<center><a href="/"><img alt="eBookSearch" border="0" hspace="10"  src="{{MEDIA_URL}}/pic/title.png" title="eBookSearch" /></a></center>
    <h2>{%trans "Extended search"%}</h2>
    <form name="extended_search" onsubmit="return checkForm(this);" action="search">
    
        <table>    
            <tr><td>{%trans "Title"%}:</td>
            <td>  <input type="text" style="width: 253px;" name="title" id="id_title" value="{{ title.tit }}">
            {%if USE_AUTOCOMPLETE%}
            <script type="text/javascript">function author_value() { return $('#id_author').val(); }
            $('#id_title').autocomplete("/extended_search/autocomplete_title", {
                "extraParams": {
                    "author": author_value
                }
            });</script>
            {%endif%}</td>
            <td><input type="submit" value="{%trans "Search"%}" ></td>
            <td>&nbsp;&nbsp;<a href="/" rel="simple search">{%trans "Simple search"%}</a></td>
            </tr><tr>
            <td>{%trans "Author"%}:</td> 
            <td> <input type="text" style="width: 253px;" name="author" value="{{ title.author }}" id="id_author"></td>
            {%if USE_AUTOCOMPLETE%}
            <script type="text/javascript">function title_value() { return $('#id_title').val(); }
            $('#id_author').autocomplete("/extended_search/autocomplete_author", {
                "extraParams": {
                    "title": title_value
                }
            });</script>
            {%endif%}
            </tr><tr>
            <td style="padding-top: 20px;">{%trans "Language"%}:</td>  
            <td style="padding-top: 20px;"><select name="lang"  width="260" style="width: 260px">
                <option value="">--None--</option>
                {% ifequal "en" title.lang %}
                    <option selected value="en">English</option>
                    <option value="ru">Russian</option>
                    <option value="fr">French</option>
                    <option disabled>-----------</option> 
                    {% for lang in langs %}
                        <option value="{{lang.short}}">{{lang.full}}</option>
                    {% endfor %}
                {% else %}
                    {% ifequal "ru" title.lang %}
                        <option value="en">English</option>
                        <option selected value="ru">Russian</option>
                        <option value="fr">French</option>
                        <option disabled>-----------</option> 
                        {% for lang in langs %}
                            <option value="{{lang.short}}">{{lang.full}}</option>
                        {% endfor %}
                    {% else %}
                        {% ifequal "fr" title.lang %}
                            <option value="en">English</option>
                            <option value="ru">Russian</option>
                            <option selected value="fr">French</option>
                            <option disabled>-----------</option> 
                            {% for lang in langs %}
                                <option value="{{lang.short}}">{{lang.full}}</option>
                            {% endfor %}
                        {% else %}
                            <option value="en">English</option>
                            <option value="ru">Russian</option>
                            <option value="fr">French</option>
                            <option disabled>-----------</option>
                            {% for lang in langs %}
                                {% ifequal lang.short title.lang %} 
                                    <option selected value="{{lang.short}}">{{lang.full}}</option>                    
                                {% else %}
                                <option value="{{lang.short}}">{{lang.full}}</option>
                                {% endifequal %}
                            {% endfor %}                            
                        {% endifequal %}
                    {% endifequal %}
                {% endifequal %}
                </select>
            </td>

            </tr><tr>
            <td>{%trans "Tag"%}:</td>
            <td><select name="tag"  width="260" style="width: 260px">
                <option value="">--None--</option>
                {% for tag in tags %}
                    {% ifequal tag.name title.tag %} 
                        <option selected value="{{tag.name}}">{{tag.name}}</option>
                    {% else %}
                        <option value="{{tag.name}}">{{tag.name}}</option>
                    {% endifequal %}
                {% endfor %}
                </select>
            </td>
             </tr>
        </table>
        {%if suggestions%}
            {%if suggestions.title%}
                {%if suggestions.author%}
                    <h4>{%trans "Did you mean"%}: <a href="search?author={{ suggestions.author }};title={{ suggestions.title }};lang={{title.lang}};tag={{title.tag}}" class="gray">{%trans "Title"%}: {{ suggestions.title }}  {%trans "Author"%}: {{ suggestions.author }}</a></em></h4>
                {%else%}
                <h4>{%trans "Did you mean"%}: <a href="search?author={{ title.author }};title={{ suggestions.title }};lang={{title.lang}};tag={{title.tag}}" class="gray">{%trans "Title"%}: {{ suggestions.title }}  
                            {%if title.author%}{%trans "Author"%}: {{ title.author }} {%endif%}</a></em></h4>
                {%endif%}
            {%else%}
                {%if suggestions.author%}
                    <h4>Did you mean: <a href="search?author={{ suggestions.author }};title={{ title.tit }};lang={{title.lang}};tag={{title.tag}}" class="gray">{%if title.tit%}{%trans "Title"%}: {{ title.tit }}{%endif%}  {%trans "Author"%}: {{ suggestions.author }}</a></em></h4>
                {%endif%}
            {%endif%}

        {%endif%}
        
    </form>

</div>

